import json
from .malware_config import MalwareConfig


class MarcherConfig(MalwareConfig):
    name = "marcher_config"
    description = "Analyze Marcher configuration."

    # This should only be triggered manually, or by a config extraction
    triggered_by = "*marcher*"

    extraction_label = "Marcher Configuration"

    def get_config_blocks(self, content):
        config = json.loads(content)
        block = "C2\n\n{}\n\nOverlay\n\n".format("\n".join(config['c2_urls']))

        for overlay in config['overlays']:
            yield overlay['to'], 'overlay', block + overlay['body'], None

    def family(self):
        return "Marcher"
